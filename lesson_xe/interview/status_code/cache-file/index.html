<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <ul id="users"></ul>

    <script>
      window.onload = function () {
        const userUL = document.getElementById("users");
        const users = JSON.parse(localStorage.getItem("users")); //JSON.parse将 JSON 字符串转换为对象。
        // console.log(users)
        // 但是服务器端内容改变了怎么办？
        const version = localStorage.getItem('version')
        console.log(version)
        if (users) {
          console.log("已经缓存了");
          userUL.innerHTML = users
            .map((user) => `<li>${user.username} -${user.hometown}</li>`)
            .join("");
          return;
        }

        fetch("/user") //请求 /user的url
          .then((data) => data.json()) //把string 变成json
          .then((data) => {
            localStorage.setItem("users", JSON.stringify(data));
            userUL.innerHTML = data
              .map((user) => `<li>${user.username} -${user.hometown}</li>`)
              .join("");
            // console.log(data)
          });
      };
    </script>
  </body>
</html>
